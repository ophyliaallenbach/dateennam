<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8">
    <title>Vitrine Culturelle ‚ú®</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>‚ú®</text></svg>">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
      /* PALETTE "PLUIE DE JUIN" (M√™me th√®me que ta page admin) */
      :root { --misty-violet: #5f5baf; --rainy-blue: #568de4; --rain-purple: #ba9fe1; --deep-iris: #9a64c5; --cloudy-lilac: #c4c5e8; --white: #ffffff; --alert-red: #e57373; }
      body { font-family: 'Segoe UI', sans-serif; background-color: var(--cloudy-lilac); color: var(--misty-violet); text-align: center; margin: 0; padding: 20px; background-image: linear-gradient(to bottom, #c4c5e8 0%, #dce0f5 100%); min-height: 100vh; }
      
      h1 { color: var(--misty-violet); margin-top: 40px; font-size: 2.2em; text-shadow: 2px 2px 0px rgba(255,255,255,0.4); margin-bottom: 5px; }
      .phrase { font-style: italic; color: var(--deep-iris); margin-bottom: 40px; font-weight: 500; }
      
      /* BOUTON RETOUR */
      .top-nav { position: fixed; top: 10px; left: 10px; z-index: 1000; }
      .btn-back { background: rgba(255,255,255,0.6); color: var(--misty-violet); border: none; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; backdrop-filter: blur(5px); text-decoration: none; display: flex; align-items: center; gap: 5px; transition: 0.2s; }
      .btn-back:hover { background: var(--white); transform: translateY(-2px); }

      /* CARTES */
      #sorties { display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; padding-bottom: 50px; max-width: 1200px; margin: 0 auto; }
      .carte { background: var(--white); width: 280px; padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(95, 91, 175, 0.1); text-align: left; transition: transform 0.2s; position: relative; border-top: 6px solid var(--rainy-blue); animation: fadeIn 0.5s ease; }
      .carte:hover { transform: translateY(-5px); }
      
      .carte h3 { margin: 0 0 10px 0; color: var(--misty-violet); font-size: 1.4em; }
      .carte p { color: #666; line-height: 1.5; font-size: 1em; margin: 8px 0; }
      
      .badge-cat { font-size: 0.85em; background: var(--cloudy-lilac); padding: 4px 10px; border-radius: 12px; color: var(--misty-violet); font-weight: bold; display: inline-block; margin-bottom: 5px; }
      
      /* Style date de fin */
      .date-fin-alert { color: var(--alert-red); font-weight: bold; font-size: 0.95em; display: block; margin-top: 10px; background: #ffebee; padding: 5px 10px; border-radius: 8px; text-align: center; border: 1px dashed var(--alert-red); }
      .date-prevue { color: var(--rainy-blue); font-weight: bold; display: block; margin-top: 5px; }

      @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
      
      .empty-msg { font-style: italic; color: var(--misty-violet); margin-top: 50px; font-size: 1.2em; }
    </style>
  </head>
  <body>
    
    <div class="top-nav">
        <a href="login.html" class="btn-back">‚¨Ö Retour</a>
    </div>

    <h1>‚ú® Vitrine Culturelle</h1>
    <div class="phrase">Nos envies du moment...</div>

    <div id="sorties">Chargement...</div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyD9bzSuQY8CR9RVnQMu6WI4plznzQrfBC4", authDomain: "date-d927b.firebaseapp.com", projectId: "date-d927b", storageBucket: "date-d927b.appspot.com", messagingSenderId: "353304192798", appId: "1:353304192798:web:1511fa87bfbf11bdda0b0f", measurementId: "G-T4N8PMNC3G" };
        if (typeof firebase !== 'undefined' && !firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        let db; try { db = firebase.firestore(); } catch (e) { console.error("Erreur:", e); }

        function chargerVitrine() { 
            const container = document.getElementById('sorties'); 
            
            // On r√©cup√®re les id√©es (collection "dates")
            db.collection("dates").orderBy("timestamp", "desc").onSnapshot((snapshot) => { 
                container.innerHTML = ""; 
                
                if(snapshot.empty) { 
                    container.innerHTML = "<p class='empty-msg'>Rien de pr√©vu pour l'instant... üí§</p>"; 
                    return; 
                } 
                
                snapshot.forEach((doc) => { 
                    const data = doc.data(); 
                    const nom = data.texte || data.nom || "Id√©e myst√®re"; 
                    const cats = data.categories ? data.categories.join(" ") : ""; 
                    const prix = data.prix ? `üí∏ ${data.prix}‚Ç¨` : ""; 
                    const lieu = data.lieu ? `üìç ${data.lieu}` : ""; 
                    
                    // Gestion Date Pr√©vue
                    const dateHtml = data.date ? `<span class="date-prevue">üìÖ Pr√©vu : ${data.date}</span>` : ""; 
                    
                    // Gestion Date Fin (ALERTE)
                    let dateFinHtml = "";
                    if (data.dateFin) {
                        dateFinHtml = `<span class="date-fin-alert">‚è≥ Finit le : ${data.dateFin}</span>`;
                    }

                    const carte = document.createElement("div"); 
                    carte.className = "carte"; 
                    carte.innerHTML = `
                        ${cats ? `<span class="badge-cat">${cats}</span>` : ""}
                        <h3>${nom}</h3>
                        <p>${lieu} ${prix ? `| ${prix}` : ""}</p>
                        ${dateHtml}
                        ${dateFinHtml}
                    `; 
                    container.appendChild(carte); 
                }); 
            }); 
        }
        
        document.addEventListener('DOMContentLoaded', () => { chargerVitrine(); });
    </script>
  </body>
</html>
