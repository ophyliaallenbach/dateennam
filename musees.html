<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mes Mus√©es 2026 üèõÔ∏è</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        body { background-color: #E3F2FD; color: #0D47A1; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        h1 { text-align: center; color: #1565C0; margin-bottom: 40px; }
        
        /* BOUTON DECONNEXION (En haut √† droite) */
        .btn-logout {
            position: absolute;
            top: 20px;
            right: 20px;
            background-color: #ff5252;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .btn-logout:hover { background-color: #d32f2f; }

        /* LAYOUT */
        .top-section { display: flex; gap: 30px; max-width: 1200px; margin: 0 auto; align-items: flex-start; }
        .form-container { flex: 1; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: sticky; top: 20px; }
        
        /* CARTES */
        .cards-container { flex: 1; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .card-tinder { background: white; width: 100%; max-width: 300px; padding: 20px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border: 1px solid #BBDEFB; transition: transform 0.2s; position: relative; }
        .card-tinder:hover { transform: translateY(-5px); }
        .badge-gratuit { display: inline-block; background: #ffecb3; color: #f57f17; padding: 2px 6px; border-radius: 4px; font-size: 0.8em; margin-right: 4px; margin-bottom: 4px; }

        /* LISTE VISITES */
        .history-section { max-width: 1200px; margin: 50px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .visite-row { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        
        /* CHAMPS */
        input[type="text"], input[type="number"], input[type="date"], select, textarea { width: 100%; padding: 12px; margin: 8px 0 15px 0; border: 1px solid #90CAF9; border-radius: 8px; box-sizing: border-box; }
        
        /* STYLE DES CHECKBOX GRATUIT√âS */
        .gratuites-container { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 20px; }
        .gratuites-container label { 
            background: #E1F5FE; color: #0277BD; padding: 5px 10px; border-radius: 15px; font-size: 0.9em; cursor: pointer; display: flex; align-items: center; border: 1px solid #B3E5FC;
        }
        .gratuites-container input { width: auto; margin-right: 5px; }
        .gratuites-container label:hover { background: #B3E5FC; }

        /* ZONE CACH√âE */
        #detailsVisite { display: none; background-color: #E1F5FE; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 2px dashed #81D4FA; }
        
        /* BOUTONS */
        button.btn-save { width: 100%; padding: 12px; background-color: #1976D2; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold; }
        button.btn-save:hover { background-color: #1565C0; }
        button.btn-check { background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; }
        
        /* GROSSE CHECKBOX DEJA VISIT√â */
        .main-checkbox { display: flex; align-items: center; margin-bottom: 20px; cursor: pointer; font-weight: bold; color: #1565C0; border-top: 1px solid #eee; padding-top: 15px; }
        .main-checkbox input { width: auto; margin: 0 10px 0 0; transform: scale(1.5); }
    </style>
</head>
<body>

    <button class="btn-logout" onclick="deconnexion()">D√©connexion ‚úåÔ∏è</button>

    <h1>üèõÔ∏è Mes Mus√©es en 2026</h1>

    <div class="top-section">
        <div class="form-container">
            <h2>Ajouter un mus√©e</h2>
            <input type="text" id="nomMusee" placeholder="Nom du mus√©e (ex: Louvre)">
            <input type="text" id="nomExpo" placeholder="Nom de l'expo (ou 'Permanente')">
            <input type="number" id="prixMusee" placeholder="Prix (‚Ç¨)">

            <p style="margin: 0 0 10px 0; font-weight: bold; font-size: 0.9em; color:#555;">R√©ductions / Gratuit√©s :</p>
            <div class="gratuites-container" id="tagsContainer">
                <label><input type="checkbox" value="Icom"> Icom</label>
                <label><input type="checkbox" value="Etudiant"> √âtudiant</label>
                <label><input type="checkbox" value="RSA"> RSA</label>
                <label><input type="checkbox" value="-26ans"> -26 ans</label>
                <label><input type="checkbox" value="Navigo"> Navigo</label>
                <label><input type="checkbox" value="Pour tous"> Pour tous</label>
                <label><input type="checkbox" value="Autre"> Autre</label>
            </div>

            <label class="main-checkbox">
                <input type="checkbox" id="estVisite" onchange="basculerDetails()">
                C'est d√©j√† fait (D√©j√† visit√©)
            </label>

            <div id="detailsVisite">
                <label>Date de visite :</label>
                <input type="date" id="dateVisite">
                <label>Ta note :</label>
                <select id="noteVisite">
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Incroyable)</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (Super)</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê (Sympa)</option>
                    <option value="2">‚≠ê‚≠ê (Bof)</option>
                    <option value="1">‚≠ê (Nul)</option>
                </select>
                <textarea id="commentaire" rows="3" placeholder="Tes petits mots √† ajouter..."></textarea>
            </div>

            <button class="btn-save" onclick="ajouterMusee()">Enregistrer</button>
        </div>

        <div class="cards-container" id="listeAVisiter"></div>
    </div>

    <div class="history-section">
        <h2>‚úÖ D√©j√† visit√©s (Souvenirs)</h2>
        <div id="listeVisites"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyD9bzSuQY8CR9RVnQMu6WI4plznzQrfBC4",
            authDomain: "date-d927b.firebaseapp.com",
            projectId: "date-d927b",
            storageBucket: "date-d927b.appspot.com",
            messagingSenderId: "353304192798",
            appId: "1:353304192798:web:1511fa87bfbf11bdda0b0f",
            measurementId: "G-T4N8PMNC3G"
        };

        if (!firebase.apps.length) { firebase.initializeApp(firebaseConfig); }
        const db = firebase.firestore();

        // Fonction de d√©connexion
        function deconnexion() {
            localStorage.removeItem("estConnecte");
            window.location.href = "login.html";
        }

        function basculerDetails() {
            const caseCochee = document.getElementById("estVisite").checked;
            document.getElementById("detailsVisite").style.display = caseCochee ? "block" : "none";
        }

        function ajouterMusee() {
            const nom = document.getElementById('nomMusee').value;
            const expo = document.getElementById('nomExpo').value;
            const prix = document.getElementById('prixMusee').value;
            const estVisite = document.getElementById('estVisite').checked;

            const checkboxes = document.querySelectorAll('#tagsContainer input[type="checkbox"]:checked');
            const tags = Array.from(checkboxes).map(cb => cb.value);

            if (!nom) return;

            let data = {
                nom: nom,
                expo: expo || "Permanente",
                prix: prix || "0",
                tags: tags,
                estVisite: estVisite,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            if (estVisite) {
                data.dateVisite = document.getElementById('dateVisite').value;
                data.note = document.getElementById('noteVisite').value;
                data.commentaire = document.getElementById('commentaire').value;
            }

            db.collection('musees').add(data).then(() => {
                document.getElementById('nomMusee').value = '';
                document.getElementById('nomExpo').value = '';
                document.getElementById('prixMusee').value = '';
                document.getElementById('commentaire').value = '';
                
                document.getElementById('estVisite').checked = false;
                document.querySelectorAll('#tagsContainer input').forEach(cb => cb.checked = false);
                
                basculerDetails();
            });
        }

        function chargerMusees() {
            const divAVisiter = document.getElementById('listeAVisiter');
            const divVisites = document.getElementById('listeVisites');

            db.collection('musees').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                divAVisiter.innerHTML = '';
                divVisites.innerHTML = '';

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const id = doc.id;

                    let tagsHtml = '';
                    if (data.tags && data.tags.length > 0) {
                        tagsHtml = data.tags.map(tag => `<span class="badge-gratuit">${tag}</span>`).join('');
                    }

                    if (data.estVisite) {
                        const row = document.createElement('div');
                        row.className = 'visite-row';
                        row.innerHTML = `
                            <div>
                                <strong>${data.nom}</strong> (${data.expo})<br>
                                <small>üìÖ ${data.dateVisite || '?'} | üí∏ ${data.prix}‚Ç¨ ${tagsHtml}</small><br>
                                <em>"${data.commentaire || ''}"</em>
                            </div>
                            <div>
                                ${"‚≠ê".repeat(data.note || 1)} 
                                <button onclick="supprimerMusee('${id}')" style="color:#d32f2f;border:none;background:none;cursor:pointer;margin-left:10px;">üóëÔ∏è</button>
                            </div>`;
                        divVisites.appendChild(row);
                    } else {
                        const card = document.createElement('div');
                        card.className = 'card-tinder';
                        card.innerHTML = `
                            <h3>${data.nom}</h3>
                            <p style="color:#666">${data.expo}</p>
                            <p>üí∏ ${data.prix}‚Ç¨</p>
                            <div style="margin-bottom:10px;">${tagsHtml}</div>
                            <button class="btn-check" onclick="passerEnVisite('${id}')">‚úÖ Fait !</button>
                            <button onclick="supprimerMusee('${id}')" style="float:right;color:#d32f2f;border:none;background:none;cursor:pointer;">üóëÔ∏è</button>
                        `;
                        divAVisiter.appendChild(card);
                    }
                });
                
                if(divAVisiter.innerHTML === "") divAVisiter.innerHTML = "<p style='color:#777'>Rien de pr√©vu...</p>";
            });
        }

        function passerEnVisite(id) {
            const note = prompt("Note /5 ?");
            if(note) {
                const date = prompt("Date ? (AAAA-MM-JJ)", new Date().toISOString().split('T')[0]);
                db.collection('musees').doc(id).update({ estVisite: true, note: note, dateVisite: date });
            }
        }

        function supprimerMusee(id) {
            if(confirm("Supprimer ?")) db.collection('musees').doc(id).delete();
        }

        chargerMusees();
    </script>
</body>
</html>
