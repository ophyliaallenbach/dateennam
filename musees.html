<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Mes Mus√©es 2026 üèõÔ∏è</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        body { background-color: #E3F2FD; color: #0D47A1; font-family: 'Segoe UI', sans-serif; padding: 20px; }
        h1 { text-align: center; color: #1565C0; }
        
        .top-section { display: flex; gap: 30px; max-width: 1200px; margin: 0 auto; align-items: flex-start; }
        .form-container { flex: 1; background: white; padding: 25px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); position: sticky; top: 20px; }
        .cards-container { flex: 1; display: flex; flex-wrap: wrap; gap: 15px; justify-content: center; }
        .card-tinder { background: white; width: 100%; max-width: 300px; padding: 20px; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1); border: 1px solid #BBDEFB; transition: transform 0.2s; position: relative; }
        .history-section { max-width: 1200px; margin: 50px auto; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .visite-row { border-bottom: 1px solid #eee; padding: 15px 0; display: flex; justify-content: space-between; align-items: center; }
        
        input, select, textarea { width: 100%; padding: 12px; margin: 8px 0 20px 0; border: 1px solid #90CAF9; border-radius: 8px; box-sizing: border-box; }
        
        #detailsVisite { 
            display: none; 
            background-color: #E1F5FE; 
            padding: 15px; 
            border-radius: 10px; 
            margin-bottom: 20px; 
            border: 2px dashed #81D4FA; 
        }
        
        button.btn-save { width: 100%; padding: 12px; background-color: #1976D2; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 18px; font-weight: bold; }
        button.btn-check { background: #4CAF50; color: white; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; width: 100%; margin-top: 10px; }
        .checkbox-container { display: flex; align-items: center; margin-bottom: 20px; cursor: pointer; font-weight: bold; color: #1565C0; }
        .checkbox-container input { width: auto; margin: 0 10px 0 0; transform: scale(1.5); }
    </style>
</head>
<body>

    <h1>üèõÔ∏è Mes Mus√©es en 2026</h1>

    <div class="top-section">
        <div class="form-container">
            <h2>Ajouter un mus√©e</h2>
            <input type="text" id="nomMusee" placeholder="Nom du mus√©e (ex: Louvre)">
            <input type="text" id="nomExpo" placeholder="Nom de l'expo (ou 'Permanente')">
            <input type="number" id="prixMusee" placeholder="Prix (‚Ç¨)">

            <label class="checkbox-container">
                <input type="checkbox" id="estVisite" onchange="basculerDetails()">
                C'est d√©j√† fait (D√©j√† visit√©)
            </label>

            <div id="detailsVisite">
                <label>Date de visite :</label>
                <input type="date" id="dateVisite">
                <label>Ta note :</label>
                <select id="noteVisite">
                    <option value="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê (Incroyable)</option>
                    <option value="4">‚≠ê‚≠ê‚≠ê‚≠ê (Super)</option>
                    <option value="3">‚≠ê‚≠ê‚≠ê (Sympa)</option>
                    <option value="2">‚≠ê‚≠ê (Bof)</option>
                    <option value="1">‚≠ê (Nul)</option>
                </select>
                <textarea id="commentaire" rows="3" placeholder="Tes petits mots √† ajouter..."></textarea>
            </div>

            <button class="btn-save" onclick="ajouterMusee()">Enregistrer</button>
        </div>

        <div class="cards-container" id="listeAVisiter">
            <p>Chargement...</p>
        </div>
    </div>

    <div class="history-section">
        <h2>‚úÖ D√©j√† visit√©s (Souvenirs)</h2>
        <div id="listeVisites"></div>
    </div>

    <script>
        // 1. CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyD9bzSuQY8CR9RVnQMu6WI4plznzQrfBC4",
            authDomain: "date-d927b.firebaseapp.com",
            projectId: "date-d927b",
            storageBucket: "date-d927b.appspot.com",
            messagingSenderId: "353304192798",
            appId: "1:353304192798:web:1511fa87bfbf11bdda0b0f",
            measurementId: "G-T4N8PMNC3G"
        };

        // 2. INITIALISATION
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.firestore();

        // 3. FONCTIONS VISUELLES
        function basculerDetails() {
            const caseCochee = document.getElementById("estVisite").checked;
            const zoneCachee = document.getElementById("detailsVisite");
            if (caseCochee) {
                zoneCachee.style.display = "block";
            } else {
                zoneCachee.style.display = "none";
            }
        }

        // 4. FONCTION ENREGISTRER (AVEC TEST)
        function ajouterMusee() {
            // TEST : Est-ce que le bouton marche ?
            alert("üëÜ J'essaie d'enregistrer... Si tu vois ce message, le bouton fonctionne !");

            const nom = document.getElementById('nomMusee').value;
            const expo = document.getElementById('nomExpo').value;
            const prix = document.getElementById('prixMusee').value;
            const estVisite = document.getElementById('estVisite').checked;

            if (!nom) { 
                alert("‚ö†Ô∏è Il manque le nom du mus√©e !"); 
                return; 
            }

            let data = {
                nom: nom,
                expo: expo || "Permanente",
                prix: prix || "0",
                estVisite: estVisite,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            if (estVisite) {
                data.dateVisite = document.getElementById('dateVisite').value;
                data.note = document.getElementById('noteVisite').value;
                data.commentaire = document.getElementById('commentaire').value;
            }

            console.log("Envoi des donn√©es...", data);

            // ENVOI VERS FIREBASE
            db.collection('musees').add(data)
            .then(() => {
                alert("‚úÖ C'est enregistr√© dans la base de donn√©es !");
                // Reset du formulaire
                document.getElementById('nomMusee').value = '';
                document.getElementById('commentaire').value = '';
                document.getElementById('estVisite').checked = false;
                basculerDetails(); 
            })
            .catch((error) => {
                // C'est ici qu'on verra l'erreur technique si √ßa plante
                alert("‚ùå ERREUR : " + error.message);
                console.error("Erreur Firebase : ", error);
            });
        }

        // 5. CHARGEMENT DES DONN√âES
        function chargerMusees() {
            const divAVisiter = document.getElementById('listeAVisiter');
            const divVisites = document.getElementById('listeVisites');

            db.collection('musees').orderBy('timestamp', 'desc').onSnapshot(snapshot => {
                divAVisiter.innerHTML = '';
                divVisites.innerHTML = '';

                snapshot.forEach(doc => {
                    const data = doc.data();
                    const id = doc.id;

                    if (data.estVisite) {
                        const row = document.createElement('div');
                        row.className = 'visite-row';
                        row.innerHTML = `<div><strong>${data.nom}</strong> (${data.expo})<br><small>${data.dateVisite || '?'} | ${data.prix}‚Ç¨</small><br><em>"${data.commentaire || ''}"</em></div><div>${"‚≠ê".repeat(data.note || 1)} <button onclick="supprimerMusee('${id}')" style="color:red;border:none;background:none;cursor:pointer;">üóëÔ∏è</button></div>`;
                        divVisites.appendChild(row);
                    } else {
                        const card = document.createElement('div');
                        card.className = 'card-tinder';
                        card.innerHTML = `<h3>${data.nom}</h3><p>${data.expo}</p><p>${data.prix}‚Ç¨</p><button class="btn-check" onclick="passerEnVisite('${id}')">‚úÖ Fait !</button><button onclick="supprimerMusee('${id}')" style="float:right;color:red;border:none;background:none;cursor:pointer;">üóëÔ∏è</button>`;
                        divAVisiter.appendChild(card);
                    }
                });
            });
        }

        function passerEnVisite(id) {
            const note = prompt("Note /5 ?");
            if(note) db.collection('musees').doc(id).update({ estVisite: true, note: note });
        }

        function supprimerMusee(id) {
            if(confirm("Supprimer ?")) db.collection('musees').doc(id).delete();
        }

        // LANCEMENT
        chargerMusees();
    </script>
</body>
</html>
